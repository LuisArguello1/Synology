<div x-show="currentStep === 4" class="h-full flex flex-col">
    <div class="mb-4">
        <h2 class="text-lg font-semibold text-gray-800">Asignar cuota de grupo</h2>
        <p class="text-xs text-gray-600 mt-1">Establezca límites de uso de almacenamiento para este grupo en cada volumen.</p>
    </div>
    
    <div class="flex-1 overflow-y-auto pr-1 space-y-3 pb-2" x-data="{ expandedVol: null }">
         <template x-for="vol in options.volumes" :key="vol.id">
            <div class="border border-gray-200 rounded overflow-hidden">
                <!-- Header Accordion -->
                <button type="button" @click="expandedVol = expandedVol === vol.id ? null : vol.id"
                    class="w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100 transition-colors focus:outline-none">
                    <div class="flex items-center gap-3">
                         <i class="fas fa-hdd text-gray-400 text-lg"></i>
                         <div class="text-left">
                             <div class="text-sm font-semibold text-gray-700" x-text="vol.name"></div>
                             <div class="text-xs text-gray-500">
                                <span x-text="formData.quotas[vol.id]?.is_unlimited ? 'Sin límite' : ((formData.quotas[vol.id]?.amount || 0) + ' ' + (formData.quotas[vol.id]?.unit || 'MB'))"></span>
                             </div>
                         </div>
                    </div>
                     <i class="fas text-gray-400 text-xs transition-transform transform"
                       :class="{'fa-chevron-down': expandedVol !== vol.id, 'fa-chevron-up': expandedVol === vol.id}"></i>
                </button>
                
                <!-- Body Accordion -->
                 <div x-show="expandedVol === vol.id" 
                     class="px-4 py-4 bg-white border-t border-gray-200">
                     
                     <div class="flex items-center gap-4">
                         <label class="flex items-center gap-2 cursor-pointer">
                             <input type="checkbox" x-model="formData.quotas[vol.id].is_unlimited"
                                class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                             <span class="text-sm text-gray-700">Sin límite</span>
                         </label>
                         
                         <div class="flex items-center gap-2" :class="{'opacity-50 pointer-events-none': formData.quotas[vol.id].is_unlimited}">
                             <span class="text-sm text-gray-600">Límite:</span>
                             <input type="number" min="0" x-model.number="formData.quotas[vol.id].amount"
                                @keydown="if('+-e'.includes($event.key)) $event.preventDefault()"
                                class="w-24 px-2 py-1 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500" placeholder="0">
                                
                             <select x-model="formData.quotas[vol.id].unit"
                                class="px-2 py-1 text-sm border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 bg-white">
                                 <option value="MB">MB</option>
                                 <option value="GB">GB</option>
                                 <option value="TB">TB</option>
                             </select>
                         </div>
                     </div>
                 </div>
            </div>
         </template>
         
         <template x-if="!options.volumes || options.volumes.length === 0">
             <div class="text-center py-8 text-gray-400">
                 <i class="fas fa-database text-2xl mb-2"></i>
                 <p class="text-xs">No se detectaron volúmenes disponibles.</p>
             </div>
         </template>
    </div>
</div>
