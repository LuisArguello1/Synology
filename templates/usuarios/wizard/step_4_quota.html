<div x-show="currentStep === 4" class="space-y-4">
    <div>
        <h2 class="text-lg font-semibold text-gray-800">Asignar cuota de usuario</h2>
    </div>

    <div class="bg-white border border-gray-200 rounded flex flex-col h-[340px] overflow-hidden">
        <!-- Header -->
        <div class="bg-gray-50 border-b border-gray-200 px-4 py-2 flex items-center text-xs font-semibold text-gray-600 uppercase sticky top-0 z-10 shrink-0">
            <div class="min-w-[600px] flex w-full">
                <div class="flex-1">Volumen/carpeta c...</div>
                <div class="w-28 text-center">Cuota efectiva</div>
                <div class="w-28 text-center">Cuota de grupo</div>
                <div class="w-40 text-center">Cuota de usuario</div>
            </div>
        </div>

        <!-- Scrollable content -->
        <div class="flex-1 overflow-auto">
            <div class="min-w-[600px] divide-y divide-gray-100">
                <template x-for="vol in options.volumes" :key="vol.id || vol.name">
                    <div>
                        <!-- Volume Header -->
                        <div class="flex items-center px-4 py-2 bg-gray-50 border-b border-gray-200">
                            <div class="flex-1 text-sm font-medium text-gray-700 flex items-center">
                                <i class="fas fa-chevron-down text-[10px] mr-2 text-gray-400"></i>
                                <span x-text="(vol.name || vol).replace('/volume', 'Volumen ') + ' (btrfs)'"></span>
                            </div>
                            <div class="w-28"></div>
                            <div class="w-28"></div>
                            <div class="w-40"></div>
                        </div>

                        <!-- Shares under this volume -->
                        <template x-for="share in options.shares" :key="share.name">
                            <div class="flex items-center px-4 py-2 hover:bg-blue-50 transition-colors">
                                <!-- Share Name (indented) -->
                                <div class="flex-1 text-sm text-gray-800 pl-6" x-text="share.name"></div>

                                <!-- Cuota efectiva -->
                                <div class="w-28 text-center text-xs text-gray-500">No limitar</div>

                                <!-- Cuota de grupo -->
                                <div class="w-28 text-center text-xs text-gray-500">No limitar</div>

                                <!-- User Quota (Input + Unit) -->
                                <div class="w-40 flex items-center gap-1.5 justify-center">
                                    <input type="number" min="0" :placeholder="'Sin límite'"
                                        :value="formData.quota[share.name]?.size || ''"
                                        @input="if(!formData.quota[share.name]) formData.quota[share.name] = {size: 0, unit: 'GB'}; formData.quota[share.name].size = $event.target.value"
                                        class="w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                    <select :value="formData.quota[share.name]?.unit || 'GB'"
                                        @change="if(!formData.quota[share.name]) formData.quota[share.name] = {size: 0, unit: $event.target.value}; else formData.quota[share.name].unit = $event.target.value"
                                        class="w-14 px-1 py-1 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white">
                                        <option value="MB">MB</option>
                                        <option value="GB">GB</option>
                                        <option value="TB">TB</option>
                                    </select>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-50 border-t border-gray-200 px-4 py-2 flex justify-end items-center gap-2 shrink-0">
            <span class="text-xs text-gray-500" x-text="(options.shares?.length || 0) + ' elementos'"></span>
            <button type="button" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-sync-alt text-xs"></i>
            </button>
        </div>
    </div>

    <div class="text-xs text-blue-700">
        <span class="text-blue-600 underline">Observación:</span> Puede especificar la Cuota de usuario para un volumen
        o una carpeta individuales; en caso contrario, se aplicará la Cuota de grupo.
    </div>
</div>

