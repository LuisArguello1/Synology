<div x-show="currentStep === 5" class="space-y-4">
    <div>
        <h2 class="text-lg font-semibold text-gray-800">Asignar permisos de aplicaciones</h2>
    </div>

    <div class="bg-white border border-gray-200 rounded flex flex-col h-[340px] overflow-hidden">
        <!-- Header -->
        <div class="bg-gray-50 border-b border-gray-200 sticky top-0 z-10 shrink-0">
            <div class="min-w-[550px] flex items-center px-4 py-2 text-xs font-semibold text-gray-600">
                <div class="flex-1">Nombre</div>
                <div class="w-24 text-center">Vista previa</div>
                <div class="w-32 text-center">Permisos de grupo</div>
                <div class="w-40 text-center border-l border-gray-200 ml-2 pl-2">
                    <div class="text-xs uppercase mb-1">Permisos de usuario</div>
                    <div class="flex">
                        <div class="flex-1 text-center text-[10px]">Permitir</div>
                        <div class="flex-1 text-center text-[10px]">Denegar</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scrollable content -->
        <div class="flex-1 overflow-auto">
            <div class="min-w-[550px] divide-y divide-gray-100">
                <template x-for="app in options.apps" :key="app.name">
                    <div class="flex items-center px-4 py-2 hover:bg-blue-50 transition-colors">
                        <!-- App Name -->
                        <div class="flex-1 text-sm text-gray-800" x-text="app.name"></div>

                        <!-- Vista Previa -->
                        <div class="w-24 text-center">
                            <span class="text-xs" :class="{
                                      'text-red-600': getEffectiveApp(app.name) === 'deny',
                                      'text-green-600': getEffectiveApp(app.name) === 'allow',
                                      'text-gray-400': !getEffectiveApp(app.name) || getEffectiveApp(app.name) === '-'
                                  }"
                                x-text="getEffectiveApp(app.name) === 'deny' ? 'Denegar' : (getEffectiveApp(app.name) === 'allow' ? 'Permitir' : '-')"></span>
                        </div>

                        <!-- Permisos de Grupo -->
                        <div class="w-32 text-center">
                            <span class="text-xs text-gray-500"
                                x-text="options.group_permissions?.users?.apps?.[app.name] === true ? 'Permitir' : (options.group_permissions?.users?.apps?.[app.name] === false ? 'Denegar' : '-')"></span>
                        </div>

                        <!-- Permisos de Usuario (Checkboxes) -->
                        <div class="w-40 flex border-l border-gray-200 ml-2 pl-2">
                            <!-- Permitir -->
                            <div class="flex-1 flex justify-center">
                                <input type="checkbox" :checked="formData.apps[app.name] === 'allow'"
                                    @change="formData.apps[app.name] = $event.target.checked ? 'allow' : undefined"
                                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            </div>

                            <!-- Denegar -->
                            <div class="flex-1 flex justify-center">
                                <input type="checkbox" :checked="formData.apps[app.name] === 'deny'"
                                    @change="formData.apps[app.name] = $event.target.checked ? 'deny' : undefined"
                                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                </template>

                <div x-show="!options.apps || options.apps.length === 0" class="p-10 text-center text-gray-400 text-sm">
                    <p>No hay aplicaciones disponibles.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-50 border-t border-gray-200 px-4 py-2 flex justify-end items-center gap-2 shrink-0">
            <span class="text-xs text-gray-500" x-text="(options.apps?.length || 0) + ' elementos'"></span>
            <button type="button" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-sync-alt text-xs"></i>
            </button>
        </div>
    </div>

    <div class="text-xs text-blue-700">
        <span class="text-blue-600 underline">Observaci√≥n:</span> El permiso lo determinan los permisos de usuario y
        grupo. Prioridad de permisos: <strong>Denegar > Permitir</strong>.
    </div>
</div>

