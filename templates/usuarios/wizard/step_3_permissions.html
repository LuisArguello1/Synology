<div x-show="currentStep === 3" class="space-y-4">
    <div>
        <h2 class="text-lg font-semibold text-gray-800">Asigne permisos de carpetas compartidas</h2>
    </div>
    
    <div class="bg-white border border-gray-200 rounded overflow-hidden flex flex-col h-[340px]">
        <!-- Header -->
        <div class="bg-gray-50 border-b border-gray-200">
            <div class="flex items-center px-4 py-2 text-xs font-semibold text-gray-600">
                <div class="w-28">Nombre</div>
                <div class="w-24 text-center">Vista previa</div>
                <div class="w-32 text-center">Permisos de grupo</div>
                <div class="flex-1 text-center border-l border-gray-200 ml-2 pl-2">
                    <div class="text-xs uppercase mb-1">Permisos de usuario</div>
                    <div class="flex">
                        <div class="flex-1 text-center text-[10px]">Sin acceso</div>
                        <div class="flex-1 text-center text-[10px]">Lectura/E...</div>
                        <div class="flex-1 text-center text-[10px]">Solo lect...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- List -->
        <div class="flex-1 overflow-y-auto">
            <template x-for="share in options.shares" :key="share.name">
                <div class="flex items-center px-4 py-2 hover:bg-blue-50 border-b border-gray-100 last:border-0 transition-colors">
                    <!-- Share Name -->
                    <div class="w-28 text-sm text-gray-800 truncate" x-text="share.name"></div>

                    <!-- Vista Previa -->
                    <div class="w-24 text-center">
                        <span class="text-xs"
                              :class="{
                                  'text-red-600': getEffectivePerm(share.name) === 'na',
                                  'text-green-600': getEffectivePerm(share.name) === 'rw',
                                  'text-blue-600': getEffectivePerm(share.name) === 'ro',
                                  'text-gray-400': getEffectivePerm(share.name) === '-'
                              }" 
                              x-text="getEffectivePerm(share.name) === 'na' ? 'Sin acceso' : (getEffectivePerm(share.name) === 'rw' ? 'Lectura/Escritura' : (getEffectivePerm(share.name) === 'ro' ? 'Solo lectura' : '-'))"></span>
                    </div>

                    <!-- Permisos de Grupo -->
                    <div class="w-32 text-center">
                        <span class="text-xs text-gray-500" 
                              x-text="options.group_permissions?.users?.shares?.[share.name] || '-'"></span>
                    </div>
                    
                    <!-- Permisos de Usuario (Checkboxes) -->
                    <div class="flex-1 flex border-l border-gray-200 ml-2 pl-2">
                        <!-- NA -->
                        <div class="flex-1 flex justify-center">
                            <input type="checkbox" 
                                   :checked="formData.permissions[share.name] === 'na'"
                                   @change="formData.permissions[share.name] = $event.target.checked ? 'na' : undefined"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        </div>

                        <!-- RW -->
                        <div class="flex-1 flex justify-center">
                            <input type="checkbox" 
                                   :checked="formData.permissions[share.name] === 'rw'"
                                   @change="formData.permissions[share.name] = $event.target.checked ? 'rw' : undefined"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        </div>

                        <!-- RO -->
                        <div class="flex-1 flex justify-center">
                            <input type="checkbox" 
                                   :checked="formData.permissions[share.name] === 'ro'"
                                   @change="formData.permissions[share.name] = $event.target.checked ? 'ro' : undefined"
                                   class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </template>
            
            <div x-show="!options.shares || options.shares.length === 0" class="p-10 text-center text-gray-400 text-sm">
                <p>No hay carpetas compartidas disponibles.</p>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="bg-gray-50 border-t border-gray-200 px-4 py-2 flex justify-end items-center gap-2">
            <span class="text-xs text-gray-500" x-text="(options.shares?.length || 0) + ' elementos'"></span>
            <button type="button" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-sync-alt text-xs"></i>
            </button>
        </div>
    </div>

    <div class="text-xs text-blue-700">
        <span class="text-blue-600 underline">Observación:</span> Cuando existe un conflicto entre el permiso de usuario y el permiso de grupo, el permiso se determina en función del nivel en el orden: <strong>NA > RW > RO</strong>
    </div>
</div>
